<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>作品提交</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../../static/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/assets/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../static/assets/css/tijiaoform-elements.css">
    <link rel="stylesheet" href="../../static/assets/css/tijiaostyle.css">
    <link rel="stylesheet" type="text/css" href="../../static/assets/css/bootstrap-directional-buttons.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <![endif]-->

    <!-- Favicon and touch icons -->
    <link rel="shortcut icon" href="../../static/assets/ico/favicon.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="../../static/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="../../static/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="../../static/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../static/assets/ico/apple-touch-icon-57-precomposed.png">
    <style type="text/css">

    </style>
</head>

<body>

<br>
<a href="index">
    <button type="button" style="background-color:#33CCFF" class="btn btn-default btn-circle btn-lg"><br><strong style=""> <<返回首页 </strong><br><br><br><br><br></button></a><nobr style="font-size: 20px">→</nobr>
<a href="xinxi1">
    <button type="button" style="" class="btn btn-default btn-circle btn-x2"><strong style="">一、团队与项目信息</strong><br><br><br><br><br>
    </button>
</a>
<nobr style="font-size: 50px;vertical-align: middle ">→</nobr>
<a href="xinxi2">
    <button type="button" style="" class="btn btn-primary btn-circle btn-x2">
        <strong>二、项目说明</strong><br><br>1.项目作品展示图<br>2.思维导图<br>3.作品说明<br>4.比赛心得
    </button>
</a>
<nobr style="font-size: 50px;vertical-align: middle ">→</nobr>
<a href="xinxi3">
    <button type="button" style="" class="btn btn-success btn-circle btn-x2">
        <strong>三、作品程序说明</strong><br><br>1.硬件电路图<br>2.程序流程图<br>3.代码模块图<br></button>
</a>
<nobr style="font-size: 50px;vertical-align: middle ">→</nobr>
<a href="xinxi4">
    <button type="button" style="" class="btn btn-info btn-circle btn-x2"><strong>四、结构说明</strong><br><br>1.作品结构图<br>2.使用器材说明<br><br>
    </button>
</a>
<nobr style="font-size: 50px;vertical-align: middle ">→</nobr>
<a href="xinxi5">
    <button type="button" style="" class="btn btn-info btn-circle btn-x2"><strong>五、作品演示视频</strong><br><br><br><br><br>
    </button>
</a>
<nobr style="font-size: 50px;vertical-align: middle ">→</nobr>
<a href="xinxi6">
    <button type="button" style="background-color:#2ee9ff" class="btn btn-info btn-circle btn-x2">
        <strong>六、PDF文档提交</strong><br><br>1.打印pdf文档<br>2.提交pdf文档<br><br></button>
</a>

<!-- Top content -->
<div class="top-content">

    <div class="inner-bg">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2 text">
                    <h1><strong>六、PDF文档提交</strong></h1>
                    <div class="description">
                        <p>
                            (将所有设计信息整合为pdf文档，确认无误后上传提交，提交前需仔细阅读参赛协议并接受参赛协议)
                        </p>
                    </div>
                </div>
            </div>


        </div>

        <div class="row" id="3">
            <div class="col-sm-6 col-sm-offset-3 form-box" style="">
                <div class="form-top">
                    <h3 style="text-align: center">导出PDF设计文档并保存在本地</h3>

                </div>
                <div class="form-bottom">
                    <form>
                        <button type="button" class="btn" onclick="down()">导出PDF设计文档</button>
                    </form>

                </div>
            </div>
        </div>

        <div class="row" id="3">
            <div class="col-sm-6 col-sm-offset-3 form-box" style="">
                <div class="form-top">

                    <h3 style="text-align: center">参赛协议</h3>
                    <p>1.未成年活动选手请在监护人的陪同下阅读本须知，主办方在依据法律规定或本须知约定要求活动选手承担责任时，有权向活动选手的监护人追偿。
                        <br>2.活动选手一经确认报名、提交作品，即视为其本人及监护人充分理解本须知内容及所有活动细则，并承诺接受本须知及细则的约束。
                        <br>3.小学、初中和高中在校生均可参加本次活动，每件作品参赛作者为一个团体，一个团体人数限制为3人以内（包括3人）、指导教师1人，每个团队在海选阶段限报一件创客作品，在决赛阶段可进行本团队作品的完善。同一指导教师可以同时指导多名学生。
                        <br>4.请在线下通过学校组织进行创作，完成后以团队为单位将作品在投稿时间内在平台内进行投稿，填写报名书与申报表等所有相关信息表项，并发布作品。
                        <br>5.活动选手保证所提交的作品和资料均属真实有效，符合活动要求。提交的作品和资料一旦有误，造成的任何后果均由活动选手自行承担。
                        <br>6.活动选手提交的作品均不得涉及暴力、色情、非法宗教宣传等与国家相关法律、法规相抵触的内容。如遇此类作品，主办方有权自行决定对其采取不予评审、不予发表或删除等措施，情节严重者将提交司法机关处理。
                        <br>7.作品必须为作者原创，无版权争议，未曾参与其它竞赛活动或在公开媒体平台展播、展示。若发现涉嫌抄袭或侵犯他人著作权的行为，一律取消评奖资格。如涉及作品原创问题的版权纠纷，由申报者承担责任。
                        <br>8.参赛选手提交作品的著作权归作者所有，使用权由作者和主办单位共享。主办单位对获奖作品有宣传和展示的权利。
                        <br>9.参赛选手确认报名后，需提交作品链接（须包括设计文档和作品视频），必须正确填写选手真实姓名、地区、学校、年级、手机号码等信息，因个人信息填写有误导致比赛中或奖项发放时出现错误，造成的任何后果均由活动选手自行承担。
                        <br>10.本活动最终解释权归活动主办方所有。</p>

                </div>
                <div class="form-bottom">
                    <form th:action="@{/multiUpload}" method="post" enctype="multipart/form-data" class="login-form1">
                        <div id="in1">
                        <label><input style="width: 20px" name="Fruit" type="radio" value=""/>我已阅读参赛协议并接受参赛协议 </label>
                        <br>
                        <br>
                        <label for="select">请上传PDF设计文档</label>
                        <input type="file" name="file" accept="application/pdf" id="select"/>
                        <br>
                        </div>
                        <h3 id="in2" style="display: none">
                            已完成最终提交，无法再更改项目内容，请等待评委审核，最终结果和决赛通知会发送到注册邮箱或手机，请注意查收。
                        </h3>
                        <input type="text" name="pagepath" style="display: none" th:value="xinxi6"/>
                        <input type="text" name="formname" style="display: none" th:value="DesignDocument"/>
                        <button id="Submit" type="submit" class="btn modify">确认提交(注意:提交后便无法更改，请确认所有信息无误!)</button>

                    </form>


                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-sm-offset-3 form-box" style="">
                <div class="form-bottom">
                    <form class="login-form" method="post">
                        <a href="xinxi5"><button type="button" class="btn">返回上一步</button></a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Javascript -->
<script src="../../static/assets/js/jquery-1.11.1.min.js"></script>
<script src="../../static/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="../../static/assets/js/jquery.backstretch.min.js"></script>
<script src="../../static/assets/js/scripts.js"></script>
<script src="../../static/assets/js/html5shiv.js"></script>
<script src="../../static/assets/js/respond.min.js"></script>

<!--[if lt IE 10]>
<script src="../../static/assets/js/placeholder.js"></script>
<![endif]-->

<script src="../../static/assets/js/pdfmake.min.js"></script>
<script src="../../static/assets/js/vfs_fonts.js"></script>
</body>
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {
        var designdocument =/*[[${project.DesignDocument}]]*/ null;
        if (designdocument !== null) {
            $(".modify").attr("disabled", true);
            $("#in1").hide();
            $("#in2").show();
        }
    });
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    function down() {
        var projectname =/*[[${project.ProjectName}]]*/ null;
        var projectteamname =/*[[${project.ProjectTeamName}]]*/ null;
        var sname1 =/*[[${Student1}]]*/ null;
        var sname2 =/*[[${Student2}]]*/ null;
        var sname3 =/*[[${Student3}]]*/ null;
        var teaminfo = '作品名称：' + projectname + '\n\n' +
            '团队名称：' + projectteamname + '\n\n' +
            '队长姓名：' + sname1 + '\n\n';
        if (sname2 != null) {
            teaminfo += '队员1姓名：' + sname2 + '\n\n';
        }
        if (sname3 != null) {
            teaminfo += '队员2姓名：' + sname3 + '\n\n';
        }
        var projectdisplaymap = /*[[${ProjectDisplayMap}]]*/ null;
        var stack1 = [];
        var x = new ImageDataURL(projectdisplaymap);
        x.oncomplete = function () {
            var imgs1 = new Array();
            for (key in this.imgdata) {
                if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                    continue;
                imgs1.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
            }
            var i = imgs1.length;
            if (i > 0) {
                stack1.push('1. 作品整体图\n\n');
                stack1.push(imgs1.shift());
                i -= 1;
            }
            if (i > 0) {
                stack1.push('\n2. 作品细节图\n\n');
                stack1.push(imgs1.shift());
                i -= 1;
            }
            if (i > 0) {
                stack1.push('\n3. 全队成员与作品\n\n');
                stack1.push(imgs1.shift());
                i -= 1;
            }
            var projectmindmap =/*[[${ProjectMindMap}]]*/ null;
            var stack2 = [];
            var y = new ImageDataURL(projectmindmap);
            y.oncomplete = function () {
                var imgs2 = new Array();
                for (key in this.imgdata) {
                    if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                        continue;
                    imgs2.push('\n');
                    imgs2.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
                }
                stack2.push(imgs2);
                var projectdescription = /*[[${project.ProjectDescription}]]*/ null;
                var competitionexperience =/*[[${project.CompetitionExperience}]]*/ null;
                var hardwarecircuitdiagram = /*[[${HardwareCircuitDiagram}]]*/ null;
                var stack3 = [];
                var z = new ImageDataURL(hardwarecircuitdiagram);
                z.oncomplete = function () {
                    var imgs3 = new Array();
                    for (key in this.imgdata) {
                        if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                            continue;
                        imgs3.push('\n');
                        imgs3.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
                    }
                    stack3.push(imgs3);
                    var flowchart =/*[[${FlowChart}]]*/ null;
                    var stack4 = [];
                    var a = new ImageDataURL(flowchart);
                    a.oncomplete = function () {
                        var imgs4 = new Array();
                        for (key in this.imgdata) {
                            if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                                continue;
                            imgs4.push('\n');
                            imgs4.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
                        }
                        stack4.push(imgs4);
                        var codemodulediagram =/*[[${CodeModuleDiagram}]]*/ null;
                        var stack5 = [];
                        var b = new ImageDataURL(codemodulediagram);
                        b.oncomplete = function () {
                            var imgs5 = new Array();
                            for (key in this.imgdata) {
                                if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                                    continue;
                                imgs5.push('\n');
                                imgs5.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
                            }
                            stack5.push(imgs5);
                            var structurechart = /*[[${StructureChart}]]*/ null;
                            var equipment = /*[[${project.Equipment}]]*/ null;
                            var videourl = /*[[${project.VideoURL}]]*/ null;
                            var stack6 = [];
                            var c = new ImageDataURL(structurechart);
                            c.oncomplete = function () {
                                var imgs6 = new Array();
                                for (key in this.imgdata) {
                                    if (this.imgdata[key] == this.emptyobj)//不存在的图片直接忽略
                                        continue;
                                    imgs6.push('\n');
                                    imgs6.push({image: this.imgdata[key]});//pdfmake的图片格式{image:image dataurl}
                                }
                                stack6.push(imgs6);
                                var equipment = /*[[${project.Equipment}]]*/ null;
                                var videourl = /*[[${project.VideoURL}]]*/ null;
                                var docDefinition = {
                                    content: [
                                        {text: '米思奇创意电子编程大赛设计文档—\n' + projectname, style: ['header1']},
                                        {text: '第一部分：项目及团队信息\n', style: ['header2']},
                                        {text: teaminfo, style: ['contents']},
                                        {text: '第二部分：项目说明\n', style: ['header2']},
                                        {text: '一、项目作品展示图\n', style: ['header3']},
                                        {stack: stack1, style: ['contents']},
                                        {text: '二、思维导图\n', style: ['header3']},
                                        {stack: stack2, style: ['contents']},
                                        {text: '三、作品说明\n', style: ['header3']},
                                        {text: projectdescription, style: ['contents']},
                                        {text: '四、创作心得\n', style: ['header3']},
                                        {text: competitionexperience, style: ['contents']},
                                        {text: '第三部分：作品程序说明\n', style: ['header2']},
                                        {text: '一、硬件电路图\n', style: ['header3']},
                                        {stack: stack3, style: ['contents']},
                                        {text: '二、程序流程图\n', style: ['header3']},
                                        {stack: stack4, style: ['contents']},
                                        {text: '三、代码模块图\n', style: ['header3']},
                                        {stack: stack5, style: ['contents']},
                                        {text: '第四部分：结构说明\n', style: ['header2']},
                                        {text: '一、其他结构图\n', style: ['header3']},
                                        {stack: stack6, style: ['contents']},
                                        {text: '二、使用器材说明\n', style: ['header3']},
                                        {text: equipment, style: ['contents']},
                                        {text: '第五部分：产品操作视频\n', style: ['header2']},
                                        {text: videourl, link: videourl,style: ['contents']}

                                    ],
                                    defaultStyle: {
                                        font: 'SIMYOU'
                                    },
                                    styles: {
                                        header1: {
                                            fontSize: 22,
                                            alignment: 'center',
                                            margin: [0, 11]
                                        },
                                        header2: {
                                            fontSize: 16,
                                            alignment: 'left',
                                            margin: [0, 8]
                                        },
                                        header3: {
                                            fontSize: 14,
                                            alignment: 'left',
                                            margin: [0, 7]
                                        },
                                        contents: {
                                            fontSize: 13,
                                            alignment: 'left',
                                            margin: [0, 3]
                                        }
                                    }
                                };
                                pdfMake.fonts = {
                                    SIMYOU: {
                                        normal: 'SIMYOU.ttf',
                                        bold: 'SIMYOU.ttf',
                                        italics: 'SIMYOU.ttf',
                                        bolditalics: 'SIMYOU.ttf'
                                    }
                                };
                                pdfMake.createPdf(docDefinition).print();
                            };
                        };
                    };

                };
            };
        };
    }
</script>
<script type="text/javascript">
    function ImageDataURL(urls) {//urls必须是字符串或字符串数组
        this.completenum = 0;
        this.totalnum = 0;
        this.imgdata = new Array();
        this.emptyobj = new Object();
        this.oncomplete = function(){};
        this.getDataURL = function(url, index) {
            var c = document.createElement("canvas");
            var cxt = c.getContext("2d");
            var img = new Image();
            var dataurl;
            var p;
            p = this;
            img.src = url;
            img.onload = function() {
                var i;
                var maxwidth = 500;
                var scale = 1.0;
                if (img.width > maxwidth) {
                    scale = maxwidth / img.width;
                    c.width = maxwidth;
                    c.height = Math.floor(img.height * scale);
                } else {
                    c.width= img.width;
                    c.height= img.height;
                }
                cxt.drawImage(img, 0, 0, c.width, c.height);

                p.imgdata[index] = c.toDataURL('image/jpeg');
                for (i = 0; i < p.totalnum; ++i) {
                    if (p.imgdata[i] == null)
                        break;
                }
                if (i == p.totalnum) {
                    p.oncomplete();
                }
            };
            img.onerror = function() {
                p.imgdata[index] = p.emptyobj;
                for (i = 0; i < p.totalnum; ++i) {
                    if (p.imgdata[i] == null)
                        break;
                }
                if (i == p.totalnum) {
                    p.oncomplete();
                }
            };
        };
        if (urls instanceof Array) {
            this.totalnum = urls.length;
            this.imgdata = new Array(this.totalnum);
            for (key in urls) {
                this.getDataURL(urls[key], key);
            }
        } else {
            this.imgdata = new Array(1);
            this.totalnum = 1;
            this.getDataURL(urls, 0);
        }
    }



</script>
<script>
    $('.login-form1').on('submit', function(e) {
        var i=0;
        $(this).find('input[type="radio"]').each(function(){
            if( $(this).val() == "" ) {
                var val=$('input:radio[name="Fruit"]:checked').val();
                if(val==null){
                    e.preventDefault();
                    i=i+1;
                }
            }
            else {
                $(this).removeClass('input-error');
            }
        });
        if(i>=1){
            $("#myAlert3").show();
            alert("请确认接受参赛协议!")
        }
        var k=0;
        $(this).find('input[type="file"]').each(function(){
            if( $(this).val() == "" ) {
                e.preventDefault();
                k=k+1;
            }
            else {
                $(this).removeClass('input-error');
            }
        });
        if(k>=1){
            $("#myAlert3").show();
            alert("请选择PDF设计文档后再提交!")
        }

    });
</script>

</html>